apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

namespace: default

resources:
  - ../../base
  - istio-virtualservice.yaml
  - configmap.yaml
  - redis.yaml
  - secret-provider-class.yaml
  - clusterissuer.yaml
  - certificate.yaml
  - authz-policy.yaml

patches:
  - path: deployment-patch.yaml
    target:
      kind: Deployment
      name: chat-backend
  - path: service-patch.yaml
    target:
      kind: Service
      name: chat-backend
  - path: gateway-patch.yaml
    target:
      kind: Gateway
      name: chat-gateway
  - path: secrets-patch.yaml
# Azure-specific configuration
# This overlay adapts the base configuration for Azure AKS with Istio
# Uses AKS-managed Istio service mesh (configured via Azure portal)
# Gateway selector: istio: aks-istio-ingressgateway-external
